# Class Renaming Summary

## Overview

The internal model classes in `deepaw/models/f_nonlocal.py` have been renamed to better reflect their semantic meaning:

| Old Name | New Name | Meaning |
|----------|----------|---------|
| `E3AtomRepresentationModel` | `AtomicConfigurationModel` | Atomic Configuration (ÂéüÂ≠êÈÖçÁΩÆ) |
| `E3ProbeMessageModel` | `AtomicPotentialModel` | Atomic Potential (ÂéüÂ≠êÂäø) |

## Key Points

### ‚úÖ Backward Compatibility Maintained

1. **Pretrained weights are fully compatible** - The state_dict keys remain unchanged because they are based on attribute names (`atom_model`, `probe_model`), not class names.

2. **Legacy aliases provided** - Old class names are still available as aliases:
   ```python
   E3AtomRepresentationModel = AtomicConfigurationModel
   E3ProbeMessageModel = AtomicPotentialModel
   ```

3. **No breaking changes** - All existing code continues to work without modification.

### üìù What Changed

**File: `deepaw/models/f_nonlocal.py`**

1. **Class `E3AtomRepresentationModel` ‚Üí `AtomicConfigurationModel`**
   - Learns atomic representations through E3-equivariant message passing
   - Processes atomic positions and species to generate configuration-dependent features
   - Used as `self.atom_model` in `F_nonlocal`

2. **Class `E3ProbeMessageModel` ‚Üí `AtomicPotentialModel`**
   - Predicts charge density at probe points based on atomic representations
   - Computes the electrostatic potential-like field from atoms to probe points
   - Used as `self.probe_model` in `F_nonlocal`

3. **Updated docstrings** - Added clear descriptions for both classes

4. **Legacy aliases** - Added at the end of the file for backward compatibility

### üîç Technical Details

**State Dict Structure (Unchanged):**
```python
# Keys in state_dict remain the same:
atom_model.basis.mean
atom_model.interaction_block.convolutions.0.weight
...
probe_model.basis.mean
probe_model.interaction_block.convolutions.0.weight
probe_model.readout.weight
...
```

**Usage in F_nonlocal:**
```python
class F_nonlocal(nn.Module):
    def __init__(self, ...):
        self.atom_model = AtomicConfigurationModel(...)  # New class name
        self.probe_model = AtomicPotentialModel(...)     # New class name
```

### ‚úÖ Verification

Run the test script to verify everything works:
```bash
conda run -n DeePAW python test_renamed_classes.py
```

**Test Results:**
- ‚úì New class names work correctly
- ‚úì Legacy aliases point to new classes
- ‚úì State dict keys are preserved (148 atom_model + 180 probe_model parameters)
- ‚úì Pretrained weights load successfully
- ‚úì Total parameters: 1,903,389 (unchanged)

### üìö Semantic Meaning

**AtomicConfigurationModel (ÂéüÂ≠êÈÖçÁΩÆ)**
- Represents the spatial and chemical configuration of atoms
- Encodes how atoms are arranged in 3D space
- Captures local atomic environments and bonding patterns

**AtomicPotentialModel (ÂéüÂ≠êÂäø)**
- Represents the potential field generated by the atomic configuration
- Predicts how the atomic arrangement influences charge density
- Maps atomic features to observable charge density values

## Migration Guide

### For Users

No action required! Your existing code will continue to work:

```python
from deepaw import F_nonlocal

# This still works exactly as before
model = F_nonlocal(num_basis=10)
model.load_state_dict(torch.load('checkpoints/f_nonlocal.pth'))
```

### For Developers

If you were directly importing the internal classes, you can:

**Option 1: Use new names (recommended)**
```python
from deepaw.models.f_nonlocal import AtomicConfigurationModel, AtomicPotentialModel
```

**Option 2: Continue using old names (legacy)**
```python
from deepaw.models.f_nonlocal import E3AtomRepresentationModel, E3ProbeMessageModel
```

Both options work identically - they reference the same classes.

## Files Modified

- `deepaw/models/f_nonlocal.py` - Renamed classes and updated docstrings
- `test_renamed_classes.py` - New test script to verify compatibility

## Files Unchanged

- All checkpoint files (`checkpoints/*.pth`)
- All example scripts
- All documentation
- All other model files

